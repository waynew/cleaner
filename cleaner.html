<html>
    <head>
        <title>Cleaneriffic - Wayne's World</title>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load("visualization", "1", {packages:["corechart"]});
            google.setOnLoadCallback(drawChart);
            function drawChart() {
              var data = google.visualization.arrayToDataTable([
                ['Year', 'Sales', 'Expenses'],
                ['2004',  1000,      400],
                ['2005',  1170,      460],
                ['2006',  660,       1120],
                ['2007',  1030,      540]
              ]);

              var options = {
                title: 'The Cleaner',
                hAxis: {title: 'Stuff Cleaned',
                        titleTextStyle: {color: 'red'},
                       },
                vAxis: {
                           format: "##",
                        viewWindowMode: 'explicit',
                                        viewWindow: {'max': 30,
                                            'min': 0}

                       }
              };

              var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
              chart.draw(google.visualization.arrayToDataTable(dataAsTable()), options);
            }
            var categories = [];
            var people = [];

            function dataAsTable(){
                var zeros = new Array(people.length+1);
                for(var x = 0; x < zeros.length; x++) zeros[x] = 0;
                var cats = new Array(categories.length);
                for(var x = 0; x < cats.length; x++){
                    cats[x] = zeros.slice(0);
                    cats[x][0] = categories[x];
                }
                var data = [
                    ['Category'].concat(people),
                    ].concat(cats);
                console.log(data);
                return data;
            }

            function loadCategories(){
                categories = (localStorage['categories'] || '').split(',');
                var index = categories.indexOf('');
                if (index > -1){
                    categories.splice(index, 1);
                }
            }
            
            function loadPeople(){
                people = (localStorage['people'] || '').split(',');
                var index = people.indexOf('');
                if (index > -1){
                    people.splice(index, 1);
                }
            }

            function loadData(){
                loadCategories();
                loadPeople();
            }

            function getCategory(){
                var category = document.getElementById('category');
                return category.value;
            }

            function addCategory(){
                categories.push(getCategory());
                document.getElementById('category').value = '';
                displayCategories();
                localStorage['categories'] = categories.join(',');
            }

            function removeCategory(){
                var category = getCategory();
                var index = categories.indexOf(category);
                if (index > -1){
                    categories.splice(index, 1);
                    document.getElementById('category').value = '';
                }
                else{
                    alert('<' + category + "> doesn't exist.");
                }
                displayCategories();
                localStorage['categories'] = categories.join(',');
            }

            function getPerson(){
                var person = document.getElementById('person');
                return person.value;
            }

            function addPerson(){
                people.push(getPerson());
                document.getElementById('person').value = '';
                displayPeople();
                localStorage['people'] = people.join(',');
            }

            function removePerson(){
                var person = getPerson();
                var index = people.indexOf(person);
                if (index > -1){
                    people.splice(index, 1);
                    document.getElementById('person').value = '';
                }
                else{
                    alert('<' + person + "> doesn't exist.");
                }
                displayPeople();
                localStorage['people'] = people.join(',');
            }

            function displayPeople(){
                var output = document.getElementById('people');
                output.innerHTML = people.join('<br />');
            }

            function displayCategories(){
                var output = document.getElementById('categories');
                output.innerHTML = categories.join('<br />');
            }

            function processKey(e, enter_id, esc_id){
                if(null == e){
                    e = window.event;
                }

                if(e.keyCode == 13){
                    document.getElementById(enter_id).click();
                }
                else if(e.keyCode == 27){
                    document.getElementById(esc_id).click();
                }
            }

        </script>
    </head>
    <body>
        <div id="chart_div">
        </div>
        <div style="border: thin black solid; display: inline-block;">
            Categories:
        <div id="categories" style="border-top: thin black solid">
        </div>
        <input type="text" id="category" onkeydown="processKey(event, 'add_category', 'remove_category')" />
        <button id="add_category" onclick="addCategory()">Add</button>
        <button id="remove_category" onclick="removeCategory()">Remove</button>
        </div>

        <div style="border: thin black solid; display: inline-block; vertical-align: top;">
            People:
            <div id="people" style="border-top: thin black solid; vertical-align: top;">
            </div>
            <input type="text" id="person" onkeydown="processKey(event, 'add_person', 'remove_person')" />
            <button id="add_person" onclick="addPerson()">Add</button>
            <button id="remove_person" onclick="removePerson()">Remove</button>
        </div>

        <script>
            loadData();
            displayCategories();
            displayPeople();
            document.getElementById('category').focus();
        </script>
    </body>
</html>
